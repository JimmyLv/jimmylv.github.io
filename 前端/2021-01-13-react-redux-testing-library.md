---
layout: post
title: 'å‰ç«¯å•å…ƒæµ‹è¯•å®æˆ˜ï¼šReact + Redux Testing Library'
categories: [å‰ç«¯]
tags: [Tutorial, UnitTest, CICD, TestingLibrary, React, Redux, Router, CQRS, TDD]
published: True
---

> PPT å†…å®¹: https://jimmylv.gitee.io/slides/react-test

# ä¸ºä»€ä¹ˆè¦æœ‰å•å…ƒæµ‹è¯•ï¼Ÿ

## èµ° ğŸš¶ vs ğŸƒ è·‘

![img](https://jimmylv.gitee.io/slides/images/busy.jpeg)

> **å†™ä¸å¥½æ˜¯èƒ½åŠ›é—®é¢˜ï¼Œä¸å†™åˆ™æ˜¯æ€åº¦é—®é¢˜ã€‚**

å•å…ƒæµ‹è¯•å®¢è§‚ä¸Šå¯ä»¥è®©å¼€å‘è€…çš„å·¥ä½œæ›´é«˜æ•ˆï¼ŒReact åº”ç”¨çš„å•å…ƒæµ‹è¯•æ˜¯ä¸€å®šè¦çš„ã€‚

## å•å…ƒæµ‹è¯•çš„ä¸Šä¸‹æ–‡

![image-20210228182332955](https://raw.staticdn.net/JimmyLv/images/master/2021/image-20210228182332955.png)

è°ˆä»»ä½•ä¸œè¥¿éƒ½ä¸€å®šè¦æœ‰ä¸ªä¸Šä¸‹æ–‡ã€‚ä½ çš„è®ºè¿°ä¸èƒ½æ˜¯ã€Œå› ä¸ºå•å…ƒæµ‹è¯•æœ‰è¿™äº›å¥½å¤„ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦åšå•å…ƒæµ‹è¯•ã€ï¼Œè€Œåº”è¯¥æ˜¯ã€Œä¸åšå•å…ƒæµ‹è¯•æˆ‘ä»¬ä¼šé‡åˆ°ä»€ä¹ˆé—®é¢˜ã€ï¼Œè¿™æ ·æ‰èƒ½å›ç­”ã€Œä¸ºä»€ä¹ˆè¦å†™å•å…ƒæµ‹è¯•ã€çš„é—®é¢˜ã€‚é‚£ä¹ˆæˆ‘ä»¬è°ˆè®ºå•å…ƒæµ‹è¯•çš„ä¸Šä¸‹æ–‡æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿä¸åšå•å…ƒæµ‹è¯•æˆ‘ä»¬ä¼šé‡åˆ°ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿä¸Šå›¾ä¸ºä¸€ä¸ªäº§å“ä» idea åˆ†æã€è®¾è®¡ã€å¼€å‘ã€æµ‹è¯•åˆ°äº¤ä»˜å¹¶è·å–å¸‚åœºåé¦ˆçš„è¿‡ç¨‹ã€‚

## ç¼©çŸ­åé¦ˆå‘¨æœŸ

![img](https://jimmylv.gitee.io/slides/images/tdd/xp-feedback.png)

è€Œ**å•å…ƒæµ‹è¯•çš„ä¸Šä¸‹æ–‡å°±æ˜¯å­˜åœ¨äºã€Œæ•æ·ã€å½“ä¸­**ã€‚æ•æ·ä¸ºçš„æ˜¯æ›´å¿«åœ°äº¤ä»˜æœ‰ä»·å€¼çš„å¯å·¥ä½œçš„è½¯ä»¶ã€‚ä¸ºæ­¤ï¼Œå®ƒæœ‰ä¸€ä¸ªæŒ‡æ ‡æ¥åº¦é‡è¿™ä¸ªã€Œæ›´å¿«ã€ï¼Œé‚£å°±æ˜¯ lead timeï¼Œå®ƒåº¦é‡çš„æ˜¯ä¸€ä¸ª idea ä»æå‡ºè¢«éªŒè¯ï¼Œåˆ°æœ€ç»ˆä¸Šç”Ÿäº§ç¯å¢ƒé¢å¯¹ç”¨æˆ·çš„æ—¶é—´ã€‚æ˜¾ç„¶ï¼Œè¿™ä¸ªæ—¶é—´è¶ŠçŸ­ï¼Œè½¯ä»¶è·å¾—åé¦ˆçš„æ—¶é—´å°±è¶ŠçŸ­ï¼Œå¯¹ä»·å€¼çš„éªŒè¯å°±è¶Šå¿«å‘ç”Ÿã€‚

## å•å…ƒæµ‹è¯•çš„æ„ä¹‰

- å¦‚æœä½ è¯´æˆ‘çš„ä¸šåŠ¡éƒ¨é—¨ä¸éœ€è¦é¢‘ç¹ä¸Šçº¿ï¼Œå¹¶ä¸”æˆ‘æœ‰è¶³å¤Ÿçš„äººåŠ›æ¥è¦†ç›–æ‰‹å·¥æµ‹è¯•ï¼Œé‚£ä½ å¯ä»¥ä¸ç”¨å•å…ƒæµ‹è¯•
- å¦‚æœä½ è¯´æˆ‘ä¸åœ¨æ„ä»£ç è…åŒ–ï¼Œå¹¶ä¸”æˆ‘ä¹Ÿä¸åšé‡æ„ï¼Œé‚£ä½ å¯ä»¥ä¸ç”¨å•å…ƒæµ‹è¯•
- å¦‚æœä½ è¯´æˆ‘ä¸åœ¨æ„ä»£ç è´¨é‡ï¼Œå¥½å‡ ä¸ªæ²¡æœ‰æµ‹è¯•ä¿æŠ¤çš„ if-else è£¸å¥”ä¹Ÿä¸åœ¨è¯ä¸‹ï¼Œè„‘ä¸å¥½è¿˜åšä»€ä¹ˆç¨‹åºå‘˜ï¼Œé‚£ä½ å¯ä»¥ä¸ç”¨å•å…ƒæµ‹è¯•
- å¦‚æœä½ è¯´æˆ‘ç¡®æœ‰å¿«é€Ÿéƒ¨ç½²çš„éœ€æ±‚ï¼Œä½†æˆ‘ä»¬ä¸ care è´¨é‡é—®é¢˜ï¼Œå‡ºå›å½’é—®é¢˜å°±ä¿®ï¼Œé‚£ä½ å¯ä»¥ä¸ç”¨å•å…ƒæµ‹è¯•

é™¤æ­¤ä¹‹å¤–ï¼Œä½ å°±éœ€è¦å†™å•å…ƒæµ‹è¯•ã€‚å¦‚æœä½ æƒ³éšæ—¶æ•´ç†é‡æ„ä»£ç ï¼Œé‚£ä¹ˆä½ éœ€è¦å†™å•å…ƒæµ‹è¯•ï¼›

å¦‚æœä½ æƒ³æœ‰è‡ªåŠ¨åŒ–çš„æµ‹è¯•å¥—ä»¶æ¥å¸®ä½ å¿«é€ŸéªŒè¯æäº¤çš„å®Œæ•´æ€§ï¼Œé‚£ä¹ˆä½ éœ€è¦å†™å•å…ƒæµ‹è¯•ã€‚

è¿™ä¸ªç»“è®ºå¯¹æˆ‘ä»¬å†™ä¸å†™å•å…ƒæµ‹è¯•æœ‰ä»€ä¹ˆå½±å“å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ï¼Œä¸å†™å•å…ƒæµ‹è¯•ï¼Œä½ å°±å¿«ä¸èµ·æ¥ã€‚ä¸ºå•¥å‘¢ï¼Ÿå› ä¸ºæ¯æ¬¡å‘å¸ƒï¼Œä½ éƒ½è¦æŠ•å…¥äººåŠ›æ¥è¿›è¡Œæ‰‹å·¥æµ‹è¯•ï¼›å› ä¸ºæ²¡æœ‰æµ‹è¯•ï¼Œä½ å€¾å‘äºä¸æ•¢éšæ„é‡æ„ï¼Œè¿™åˆå¯¼è‡´ä»£ç é€æ¸è…åŒ–ï¼Œå¤æ‚åº¦ä½¿å¾—ä½ çš„å¼€å‘é€Ÿåº¦é™ä½ã€‚

é‚£ä¹ˆåœ¨è¿™ä¸ªä¸Šä¸‹æ–‡ä¸­æ¥è°ˆè¦ä¸è¦å•å…ƒæµ‹è¯•ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¾ˆæœ‰æ ¹æ®äº†ï¼Œè€Œä¸æ˜¯â€œå¼€å‘çˆ½äº†å°±ç”¨ï¼Œä¸çˆ½å°±ä¸ç”¨â€è¿™æ ·å«ç³Šçš„ç­”æ¡ˆ

## å•å…ƒæµ‹è¯•ä¸è‡ªåŠ¨åŒ–çš„å…³ç³»

![img](https://raw.staticdn.net/JimmyLv/images/master/2018/20181029222614.png)

**è‡ªåŠ¨åŒ–**å›ç­”çš„æ˜¯**è¦ä¸è¦è‡ªåŠ¨åŒ–çš„å•å…ƒæµ‹è¯•**è¿™ä¸ªé—®é¢˜ã€‚æµ‹è¯•æ˜¯é‡æ„çš„å”¯ä¸€ä¿éšœï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ²¡æœ‰æµ‹è¯•ï¼ŒåŸºæœ¬ä¸Šå°±æ²¡æ³•é‡æ„ä»£ç ï¼ˆé‡æ„æŒ‡çš„æ˜¯ [ä¸æ”¹å˜è½¯ä»¶å¯è§‚æµ‹è¡Œä¸ºçš„å‰æä¸‹æ”¹å–„ä»£ç å†…éƒ¨è®¾è®¡æˆ–å®ç°](https://www.martinfowler.com/bliki/DefinitionOfRefactoring.html) ï¼‰ï¼ŒåŸºæœ¬ä¸Šå°±åªèƒ½çœ‹ç€ä»£ç è…åŒ–ã€‚é‚£ä¹ˆï¼ŒåŸºæœ¬ä¸Šåªè¦ä½ çš„ç³»ç»Ÿéœ€è¦æŒç»­å‘å±•ï¼Œä½ å°±éœ€è¦å•å…ƒæµ‹è¯•ã€‚

**åé¦ˆé€Ÿåº¦**å›ç­”çš„æ˜¯**è¦ä¸è¦ TDDã€æµ‹è¯•å…ˆè¡Œè¿˜æ˜¯åè¡¥**è¿™ä¸ªé—®é¢˜ã€‚ç­”æ¡ˆæ˜¯ï¼Œéœ€è¦ TDDï¼Œæœ€å¥½å…ˆè¡Œï¼Œå› ä¸º[å¯ä»¥æé«˜åé¦ˆé€Ÿåº¦](https://github.com/linesh-simplicity/linesh-simplicity.github.io/issues/197)ã€‚

# å•å…ƒæµ‹è¯•åŸºç¡€

## æµ‹è¯•æ¡†æ¶ - Jest

- Fast å¤©ä¸‹æ­¦åŠŸï¼Œå”¯å¿«ä¸ç ´ã€‚
- Opinionated å¼€ç®±å³ç”¨ã€‚
- Watch Mode å®ˆæŠ¤æ¨¡å¼ã€‚
- Snapshot Testing å¿«ç…§æµ‹è¯•ã€‚

## ç¬¬ä¸€ä¸ª Jest å®ä¾‹

```bashjs
mkdir jest-demo && cd \$_
yarn init -y #--yes
yarn add jest -D #--de
```

é¦–å…ˆåˆ›å»º jest-demo é¡¹ç›®å¹¶å®‰è£… jest ä½œä¸ºé¡¹ç›® devDependencies ä¾èµ–ï¼š

## ä¸€ä¸ªç®€å•çš„çº¯å‡½æ•°

```js
const sum = (a, b) => a + b

module.exports = { sum }
```

ç„¶ååˆ›å»ºä¸€ä¸ª math.js æ–‡ä»¶ï¼Œè¾“å…¥ä¸€ä¸ªæˆ‘ä»¬ç¨åæµ‹è¯•çš„ sum å‡½æ•°:

## éº»é›€è™½å°äº”è„ä¿±å…¨

```js
const { sum } = require('./math')

describe('Math module', () => {
  test('should return sum result when one number plus another number', () => {
    // Given
    const number = 1
    const anotherNumber = 2
    // When
    const result = sum(number, anotherNumber)
    // Then
    expect(result).toBe(2)
  })
})
```

æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬å†™ç¬¬ä¸€ä¸ªæµ‹è¯•ã€‚åœ¨åŒä¸€ä¸ªæ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ª math.test.js æ–‡ä»¶ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬å°†ä½¿ç”¨ Jest æ¥æµ‹è¯• math.js ä¸­å®šä¹‰çš„å‡½æ•°:

![image-20210228183001013](https://raw.staticdn.net/JimmyLv/images/master/2021/image-20210228183001013.png)

ç„¶åè¿è¡Œ yarn test ï¼ˆæ·»åŠ  NPM Scriptï¼‰ä½ å°±å¯ä»¥çœ‹åˆ°ç›¸åº”çš„ç»“æœã€‚

## Given/When/Then çš„å¥—è·¯

![image-20210228183013307](https://raw.staticdn.net/JimmyLv/images/master/2021/image-20210228183013307.png)

éº»é›€è™½å°äº”è„ä¿±å…¨ï¼Œåœ¨ä¸Šé¢çš„ä¾‹å­å½“ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¾ˆå¤šçš„æµ‹è¯•å…ƒç´ ï¼Œä¸‹é¢å°†ä¼šä¸€ä¸€ä»‹ç»ï¼š

é¦–å…ˆæˆ‘ä»¬çœ‹åˆ°çš„æ˜¯ä¸€ä¸ªç”± it åŒ…è£¹çš„æµ‹è¯•ä¸»ä½“æœ€å°å•å…ƒï¼Œé‡‡ç”¨äº† Given When Then çš„ç»å…¸æ ¼å¼ï¼Œæˆ‘ä»¬å¸¸å¸¸ç§°ä¹‹ä¸ºæµ‹è¯•ä¸‰éƒ¨æ›²ï¼Œä¹Ÿå¯ä»¥è§£é‡Šä¸º 3A å³ï¼š

```js
expect(1 + 1).toBe(2)
expect(1 + 1).not.toBe(3)
```

åœ¨ expect åé¢çš„ toBe ç§°ä¹‹ä¸º Matcherï¼Œæ˜¯æ–­è¨€æ—¶çš„åˆ¤æ–­è¯­å¥ä»¥éªŒè¯æ­£ç¡®æ€§ âœ…ï¼Œåœ¨åé¢çš„æ–‡ç« ä¸­æˆ‘ä»¬è¿˜ä¼šæ¥è§¦æ›´å¤š Matchersï¼Œç”šè‡³å¯ä»¥æ‰©å±•ä¸€äº›ç‰¹åˆ«å®šåˆ¶çš„ Matchersã€‚

![image-20210228183057426](/Users/Jing/Library/Application Support/typora-user-images/image-20210228183057426.png)

ä¿®æ”¹æ–­è¨€çš„ç»“æœï¼Œå°±å¯ä»¥çœ‹åˆ°æˆåŠŸåçš„ç»“æœäº†ï¼š

# æ¨¡å—é—´ä¾èµ– Fake/Stub/Mock/Spy

![image-20210228183104589](https://raw.staticdn.net/JimmyLv/images/master/2021/image-20210228183104589.png)

å¦‚åŒäººç±»ä¸–ç•Œä¸­çš„ç¾ç»Šï¼Œè½¯ä»¶æ¨¡å—ä¹‹é—´å¿…ç„¶ä¹Ÿå…ä¸äº†ä¾èµ–ã€‚[Martin Fowler](https://martinfowler.com/) åœ¨ [UnitTest](https://martinfowler.com/bliki/UnitTest.html) è¿™ç¯‡æ–‡ç« å½“ä¸­å°†å•å…ƒæµ‹è¯•ä½œäº†ä¸€ä¸ªé‡è¦çš„åŒºåˆ†ï¼Œå³ä½ æ‰€æµ‹è¯•çš„å•ä½åº”è¯¥æ˜¯ç¤¾äº¤å‹ï¼ˆSocial Testsï¼‰è¿˜æ˜¯ç‹¬ç«‹å‹ï¼ˆSolitary Testsï¼‰ï¼Ÿ æƒ³è±¡ä¸€ä¸‹ä½ æ­£åœ¨æµ‹è¯•ä¸€ä¸ª Order Class çš„ price() æ–¹æ³•ï¼Œè€Œ price() æ–¹æ³•éœ€è¦åœ¨ Product å’Œ Customer Class ä¸­è°ƒç”¨ä¸€äº›å‡½æ•°ã€‚å¦‚æœä½ å¸Œæœ›å•å…ƒæµ‹è¯•æ‰€æµ‹è¯•çš„ Order æ¨¡å—æ˜¯ç‹¬ç«‹çš„ï¼Œé‚£ä¹ˆä½ å°±ä¸æƒ³ç›´æ¥ä½¿ç”¨çœŸæ­£çš„ Product æˆ– Customer Classï¼Œå› ä¸º Customer Class çš„é”™è¯¯ä¼šç›´æ¥å¯¼è‡´ Order Class çš„å•å…ƒæµ‹è¯•å¤±è´¥ã€‚ç›¸åï¼Œä½ å¯èƒ½ä¼šä½¿ç”¨ä¸€ä¸ªæ›¿èº«ä½œä¸ºä¾èµ–çš„å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬æ¥ä¸‹æ¥ä¼šæåˆ°çš„ Fake/Stub/Mock/Spyã€‚

- Database æ•°æ®åº“
- Network requests ç½‘ç»œè¯·æ±‚
- access to Files å­˜å–æ–‡ä»¶
- any External system ä»»ä½•å¤–éƒ¨ç³»ç»Ÿ

å…¶å®åœ¨ Jest å½“ä¸­ï¼ŒFake/Stub/Mock/Spy è¿™äº›æ¦‚å¿µæˆ–è®¸ä¼šæœ‰æ‰€æ··æ·†ï¼Œè€Œè¿™è·Ÿ JavaScript è¯­è¨€æœ¬èº«çš„ç‰¹ç‚¹æœ‰ä¸€å®šå…³ç³»ï¼Œä½†æ˜¯æˆ‘è§‰å¾— Jest é€šè¿‡ç»Ÿä¸€çš„ fn() æ–¹æ³•æŠŠé—®é¢˜è§£å†³å¾—è¿˜æ¯”è¾ƒæ°å½“ï¼Œè®©æˆ‘ä»¬æ¥ä¸€å—å„¿çœ‹çœ‹å®ä¾‹ ğŸŒ°ï¼š

## Mock ç”¨äºæ›¿ä»£æ•´ä¸ªæ¨¡å—

```js
import SoundPlayer from './sound-player'

const mockPlaySoundFile = jest.fn()

jest.mock('./sound-player', () => {
  return jest.fn().mockImplementation(() => {
    return { playSoundFile: mockPlaySoundFile }
  })
})
```

æˆ‘ä»¬å¯ä»¥çœ‹åˆ° jest.mock() æ–¹æ³•ä¸­çš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥å®Œå…¨æ¥ç®¡æ•´ä¸ª ./sound-player JavaScript æ¨¡å—ï¼Œæ¯”å¦‚è¯´è¿™é‡Œçš„ playSoundFile æœ¬æ¥åº”è¯¥æ˜¯ä» ./sound-player è¿™ä¸ªæ–‡ä»¶å½“ä¸­ export å‡ºæ¥çš„ï¼Œè€Œè¢« Mock ä¹‹åæˆ‘ä»¬çš„æµ‹è¯•å°±å¯ä»¥ä½¿ç”¨ Mock æ‰€è¿”å›çš„æ•°æ®æˆ–æ–¹æ³•ï¼Œä»è€Œä¿è¯æ¨¡å—æ‰€è¿”å›çš„å†…å®¹æ˜¯æˆ‘ä»¬æ‰€æœŸæœ›çš„ã€‚ä½†è¿™æ—¶éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¯¥æ¨¡æ¿çš„æ‰€æœ‰åŠŸèƒ½éƒ½å·²ç»è¢« Mock æ‰ï¼Œè€Œä¸ä¼šå†ä»åŸæ¨¡å—å½“ä¸­è¿”å›ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±éœ€è¦é‡æ–°å®ç°è¯¥æ¨¡å—ä¸­çš„æ‰€æœ‰åŠŸèƒ½ã€‚å¯åˆ«ä¸€ä¸å°å¿ƒå°±æˆäº†å¼ è‰ºè°‹å¯¼æ¼”ã€Šå½±ã€‹ç‰‡ä¸­çš„å½±å­ï¼Œè¢«å®Œå…¨â€œå–è€Œä»£ä¹‹â€ï¼Œè¿å¤«äººä¹Ÿè¢« Mock æ‰€å¸å¼•ã€‚

## Stub ç”¨äºæ¨¡æ‹Ÿç‰¹å®šè¡Œä¸º

```js
const mockFn = jest.fn()
mockFn()
expect(mockFn).toHaveBeenCalled()

// With a mock implementation:
const returnsTrue = jest.fn(() => true)
console.log(returnsTrue()) // true;
```

è¿™é‡Œçš„ç‰¹å®šè¡Œä¸ºä¹Ÿå¯ä»¥æ˜¯æ²¡æœ‰è¡Œä¸ºï¼Œjest.fn() ä»£è¡¨ç€æˆ‘å°±æ˜¯ä¸€ä¸ª Stubï¼ˆæ¡©ï¼‰ï¼Œâ€œä½ æ¥æˆ‘å°±åœ¨è¿™é‡Œï¼Œä½ èµ°æˆ‘ä¹Ÿä¾ç„¶åœ¨è¿™é‡Œï¼Œé£é›¨æ— é˜»â€ã€‚ä¸éœ€è¦ä»€ä¹ˆè¾“å…¥è¾“å‡ºï¼Œåªè¦èƒ½åœ¨æµ‹è¯•çš„æ—¶å€™éªŒè¯åˆ° Stub è¢«è°ƒç”¨è¿‡å°±è¡Œï¼Œä¹Ÿå°±èƒ½å¤Ÿæ–­è¨€åˆ°æŸå¤„ä»£ç è¢«æ‰§è¡Œï¼Œä»è€Œç¡®å®šä»£ç è¢«æµ‹è¯•æ‰€è¦†ç›–ã€‚è€Œå¦ä¸€ç§ç‰¹å®šè¡Œä¸ºå°±æ˜¯è¿”å›ç‰¹å®šçš„æ•°æ®ï¼Œå³ Stub ä¹Ÿå¯ä»¥æ ¹æ®è¾“å…¥æ¨¡æ‹Ÿè¿”å›ä¸€ç§è¾“å‡ºï¼Œä½œä¸ºæŸäº›æ¨¡å—çš„æ›¿èº«å¸®å®ƒæ¼”æˆï¼Œæ¯”å¦‚â€œå°é²œè‚‰ä»¬â€é‡åˆ°è¦è·³è½¦å•¦ã€è¦å¿å¿æˆ‘æˆ‘ï¼ˆè¯¯ï¼‰çš„æ—¶å€™å°±è¦æ‰¾æ›¿èº«ï¼Œâ€œä¸€äºŒä¸‰å››äº”å…­ä¸ƒå…«â€è¿å°è¯éƒ½ä¸ç”¨èƒŒè¿˜éœ€è¦é…éŸ³ã€‚

## Spy ç”¨äºç›‘å¬æ¨¡å—è¡Œä¸º

> Spy packages without affecting the functions code

```js
const video = require('./video')

it('plays video', () => {
  const spy = jest.spyOn(video, 'play')
  const isPlaying = video.play()

  expect(spy).toHaveBeenCalled()
  expect(isPlaying).toBe(true)
})
```

Spy å¹¶ä¸ä¼šå½±å“åˆ°åŸæœ‰æ¨¡å—çš„åŠŸèƒ½ä»£ç ï¼Œè€Œåªæ˜¯å……å½“ä¸€ä¸ªç›‘æŠ¤äººçš„ä½œç”¨ï¼Œâ€œä½ å¯ä»¥ç»§ç»­æˆ‘å‹æˆ‘ç§€ä¸Šè¯¾è®²å°è¯ï¼Œä½†æ˜¯è€å¸ˆä¼šå·å·å‘Šè¯‰ä½ å¦ˆå¦ˆï¼Œçœ‹ä½ æ”¾å­¦åè€å¦ˆä¸æ‰“æ–­ä½ çš„è…¿â€ã€‚æ¯”å¦‚è¯´ä¸Šæ–‡ä¸­çš„ video æ¨¡å—ä¸­çš„ play() æ–¹æ³•å·²ç»è¢« spy è¿‡ï¼Œé‚£ä¹ˆä¹‹å play() æ–¹æ³•åªè¦è¢«è°ƒç”¨è¿‡ï¼Œæˆ‘ä»¬å°±èƒ½åˆ¤æ–­å…¶æ˜¯å¦æ‰§è¡Œï¼Œç”šè‡³æ‰§è¡Œçš„æ¬¡æ•°ã€‚

## å¦‚ä½• Mock å…¨å±€çš„æ–¹æ³•ï¼Ÿ

```js
window.matchMedia = jest.fn().mockImplementation((query) => {
  return {
    matches: false,
    media: query,
    onchange: null,
    addListener: jest.fn(),
    removeListener: jest.fn(),
  }
})
```

æŠŠå…¨å±€çš„æ•°æ® Mock æ‰å¾ˆç®€å•ï¼Œåªéœ€è¦åƒ window.document.title = undefined è¿™æ ·ç®€å• Fake èµ‹å€¼å°±å¾ˆå®Œç¾ã€‚è€Œåƒ matchMedia è¿™æ ·çš„æ–¹æ³•åœ¨ jsdom é‡Œé¢å¹¶æ²¡æœ‰è¢«å®ç°ï¼Œè¿™æ—¶å€™æˆ‘ä»¬å½“ç„¶å°±éœ€è¦å»æŠŠå®ƒ Mock æ‰ï¼Œç®€å•æŠŠè¦ç”¨åˆ°çš„ä¸€äº›å¯¹è±¡å±æ€§èµ‹å€¼å°±å¥½ï¼Œæ€»ä¹‹ä¸è‡³äºåœ¨è¿è¡Œæ—¶æŠ¥é”™ã€‚

## ä»£ç æ¨¡å—çš„æ˜“æµ‹æ€§

ä¿æŒå•å…ƒæµ‹è¯•ç‹¬ç«‹æ€§çš„åŒæ—¶ï¼Œä¹Ÿæ˜¯åœ¨ä¿ƒä½¿ä½ å»æ€è€ƒä»€ä¹ˆæ ·çš„æ¨¡å—æ‰æ˜¯ç¬¦åˆã€ŒèŒè´£å•ä¸€åŸåˆ™ã€çš„ã€‚

å•å…ƒæµ‹è¯•ç«™åœ¨ä½¿ç”¨è€…çš„è§’åº¦æ¥ä½¿ç”¨è¯¥æ¨¡å—ï¼Œè€Œä»£ç çš„æ˜“æµ‹æ€§ä¹Ÿå°±ä»£è¡¨ç€ä»£ç çš„å¯ç»´æŠ¤æ€§ã€‚

ä»ä¸Šæ–‡çš„ä¸€äº›ä¾‹å­å½“ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹åˆ°ï¼Œä¸ç®¡æ˜¯ Fake/Stub/Mock/Spy æœ€æœ€é‡è¦çš„ä¸€ä¸ªåŸåˆ™å°±æ˜¯ã€Œç®€å•ã€ï¼Œå› ä¸ºæˆ‘ä»¬æ˜¯åœ¨å†™æµ‹è¯•ä»£ç ï¼Œè€Œæ‰€ä¾èµ–çš„æ¨¡å—å°±åº”è¯¥ä»¥æœ€ç®€å•çš„å½¢æ€å±•ç°å‡ºæ¥ï¼Œç»ä¸è¦ç»™ jest.fn() ç¼–å†™è¿‡äºå“ªæ€•ä¸€ç‚¹ç‚¹å¤æ‚çš„é€»è¾‘ã€‚å¦‚æœè¿™ä¸ªæ¨¡å—æœ‰å¤šç§è¡¨ç°å½¢æ€ï¼Œé‚£å°±æŠŠå®ƒåˆ†æˆæµ‹è¯•å•å…ƒè¿›è¡Œå¤šæ¬¡ Mockï¼Œæ¯ä¸ª it() å•å…ƒæµ‹è¯•ä¸€å®šæ˜¯é’ˆå¯¹äºå•ä¸ªåŠŸèƒ½ç‚¹è¿›è¡Œæµ‹è¯•çš„ã€‚

# å¦‚ä½•æµ‹è¯•å¼‚æ­¥ä»£ç ï¼Ÿ

```js
navigator.geolocation.getCurrentPostion() // chrome API å¼‚æ­¥è·å–å½“å‰ä½ç½®
```

å¼‚æ­¥æ˜¯ JavaScript ä¸­ç»•ä¸å¼€çš„æ°¸æ’è¯é¢˜ï¼Œå¤šäºäº† ES6+ é«˜çº§è¯­æ³•æ‰€æä¾›çš„å¤šç§ä¼˜é›…çš„å¼‚æ­¥ä»£ç æ–¹å¼ï¼Œè®©æˆ‘ä»¬å†™æµ‹è¯•ä»£ç çš„æ–¹å¼ä¹Ÿå¤šäº†å¥½å¤šç§ã€‚ï¼ˆé€ƒ

è®©æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹ä»€ä¹ˆæ˜¯å¼‚æ­¥è¯·æ±‚ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªé€šè¿‡ Chrome API è·å–å½“å‰ä½ç½®çš„å®ä¾‹ï¼Œå¯æƒ³è€ŒçŸ¥ Chrome è¦æ ¹æ® GPS ä¿¡å·æ‰èƒ½ç®—å‡ºå½“å‰çš„ç»çº¬åº¦ï¼Œç›¸å½“äºä»å«æ˜Ÿ ğŸ›° æ¥å›èµ°äº†ä¸€é­ï¼Œæ€ä¹ˆä¸ä¼šå¼‚æ­¥ï¼ˆä»£è¡¨æœ‰å»¶æ—¶ï¼Œå»¶è¿Ÿè¿”å›ï¼‰å‘¢ï¼Ÿ

## Callback å›è°ƒå‡½æ•°

```js
it('the data is peanut butter', (done) => {
  function callback(data) {
    expect(data).toBe('peanut butter')
    done()
  }

  fetchData(callback)
})
```

è¿™æ˜¯æœ€æœ€æ™®é€šçš„æ–¹å¼ï¼Œä¹Ÿæ˜¯å„å¤§æ¡†æ¶éƒ½æ”¯æŒçš„ä¸€ç§å†™æ³•ï¼Œ done() ä½œä¸ºå¼‚æ­¥ä»£ç ç»“æŸçš„ç»“æŸæ ‡å¿—ï¼Œä»è€Œè®©æµ‹è¯•æ¡†æ¶â€œçŸ¥é“â€åœ¨ç»“æŸæ—¶è¿›è¡Œæ–­è¨€ã€‚ä½†è¿™ç§æ–¹å¼ä¾µå…¥æ€§æ¯”è¾ƒå¼ºï¼Œå¯¹æµ‹è¯•è¯­å¥ä¸å‹å¥½ä¸”è¿èƒŒäº† Given/When/Then çš„ä¸‰æ®µå¼å¥—è·¯ï¼Œå°±åƒå›è°ƒåœ°ç‹±ä¸€æ ·çš„é“ç†ï¼Œå¦‚æœè®© done() å……æ–¥ç€æµ‹è¯•é‚£ä¹ˆä»£ç ä¹Ÿå°±å˜å¾—æ··ä¹±ã€‚

## Promise è®©çˆ± then() åˆ°åº•

```js
it('the data is peanut butter', () => {
  expect.assertions(1)
  return fetchData().then((data) => {
    expect(data).toBe('peanut butter')
  })
})

expect(Promise.resolve('lemon')).resolves.toBe('lemon')

expect(Promise.reject(new Error('octopus'))).rejects.toThrow('octopus')
```

å…¶å®è¿™ç§æ–¹å¼ä¹Ÿå¥½ä¸åˆ°å“ªå»ï¼Œæ— éå°±æ˜¯æŠŠ done() æ–¹å¼æ¢æˆäº† then() åˆä¸€æ¬¡å……æ–¥åœ¨æ•´ä¸ª expect å½“ä¸­ï¼Œæ··ä¹±äº† When å’Œ Then ä¸¤ç§æœ¬è¯¥åˆ†å¼€çš„æ—¶åˆ»ã€‚ä½†ä¹Ÿæœ‰ä¸€ä¸ªä¸é”™çš„ç‚¹ï¼Œå¯ä»¥é€šè¿‡ Promise çš„ .resolve() å’Œ .reject() æ–¹æ³•ä½¿æµ‹è¯•åˆ†åˆ«éªŒè¯æ­£å¸¸æˆ–å¼‚å¸¸çš„æƒ…å†µã€‚

## Async/Await è®©å¼‚æ­¥å˜å¾—åŒæ­¥

```js
test('the data is peanut butter', async () => {
  // given
  const params = {}

  // when
  const data = await fetchData(params)

  // then
  expect(data).toBe('peanut butter')
})
```

Async/Await è¯­æ³•ç³–åœ¨ä¸šåŠ¡ä»£ç å½“ä¸­å°±ç‰¹åˆ«å¥½ä½¿äº†ï¼Œå¥½å¤„ä¸å¤šè¯´ç›´æ¥çœ‹å¾—è§ï¼šåŸæœ¬éœ€è¦ done() æˆ– then() çš„åœ°æ–¹éƒ½ä¸å†æ··ä¹±ï¼Œåˆä¸€æ¬¡å›å½’åˆ°äº†æ­£å¸¸çš„ Given/When/Then ä¸‰æ®µå¼å¥—è·¯ï¼Œè®©æµ‹è¯•ä»£ç å˜å¾—éå¸¸æ¸…æ™°æ˜“è¯»ã€‚å”¯ä¸€éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ é¢å¤–çš„ expect.assertions(number) å…¶å®æ˜¯éªŒè¯åœ¨æµ‹è¯•æœŸé—´æ‰€è°ƒç”¨çš„æ–­è¨€æ•°é‡ï¼Œè¿™åœ¨æµ‹è¯•å¤šå±‚å¼‚æ­¥ä»£ç æ—¶å¾ˆæœ‰ç”¨ï¼Œä»¥ç¡®ä¿å®é™…è°ƒç”¨å›è°ƒä¸­çš„æ–­è¨€æ¬¡æ•°ã€‚

# React ç»„ä»¶æµ‹è¯•

## ç»„ä»¶åŒ–ä¸ UI æµ‹è¯•

![img](https://raw.staticdn.net/JimmyLv/images/master/2018/20181030220153.png)

åœ¨ç»„ä»¶åŒ–å‡ºç°ä¹‹å‰ï¼Œæˆ‘ä»¬éƒ½å‹æ ¹ä¸è°ˆ UI çš„**å•å…ƒ**æµ‹è¯•ï¼Œå“ªæ€•æ˜¯å¯¹äº UI é¡µé¢å±‚çº§çš„æµ‹è¯•æ¥è¯´éƒ½æ˜¯ä¸€ä»¶éå¸¸å›°éš¾çš„äº‹æƒ…ã€‚å…¶å®**ç»„ä»¶åŒ–å¹¶ä¸å…¨æ˜¯ä¸ºäº†å¤ç”¨ï¼Œå¾ˆå¤šæƒ…å†µä¸‹ä¹Ÿæ°æ°æ˜¯ä¸ºäº†åˆ†æ²»**ï¼Œä»è€Œæˆ‘ä»¬å¯ä»¥åˆ†ç»„ä»¶å¯¹ UI é¡µé¢è¿›è¡Œå¼€å‘ï¼Œç„¶ååˆ†åˆ«å¯¹å…¶è¿›è¡Œå•å…ƒæµ‹è¯•ã€‚

å‰ç«¯ç»„ä»¶åŒ–å·²ç»è®© UI æµ‹è¯•å˜å¾—å®¹æ˜“å¾ˆå¤šï¼Œæ¯ä¸ªç»„ä»¶éƒ½å¯ä»¥è¢«ç®€åŒ–ä¸ºè¿™æ ·ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œå³ UI = f(data)ï¼Œè¿™ä¸ªçº¯å‡½æ•°è¿”å›çš„åªæ˜¯ä¸€ä¸ªæè¿° UI ç»„ä»¶åº”è¯¥æ˜¯ä»€ä¹ˆæ ·å­çš„è™šæ‹Ÿ DOMï¼Œæœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªæ ‘å½¢çš„æ•°æ®ç»“æ„ã€‚ç»™è¿™ä¸ªçº¯å‡½æ•°è¾“å…¥ä¸€äº›åº”ç”¨ç¨‹åºçš„çŠ¶æ€ï¼Œå°±ä¼šå¾—åˆ°ç›¸åº”çš„ UI æè¿°çš„è¾“å‡ºï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸ä¼šå»ç›´æ¥æ“ä½œå®é™…çš„ UI å…ƒç´ ï¼Œä¹Ÿä¸ä¼šäº§ç”Ÿæ‰€è°“çš„å‰¯ä½œç”¨ã€‚

## React ç»„ä»¶æ ‘çš„æµ‹è¯•

![ComponentsTree](https://raw.staticdn.net/JimmyLv/images/master/2018/20181030211115.png)

æŒ‰ç†æ¥è¯´æŒ‰ç…§çº¯å‡½æ•°è¿™æ ·çš„æ€è·¯ï¼ŒReact ç»„ä»¶çš„æµ‹è¯•åº”è¯¥å¾ˆç®€å•çš„è¯´ã€‚ä½†ä¸æ­¤åŒæ—¶ï¼Œå¯¹ UI æ¸²æŸ“çš„ç»„ä»¶æ ‘è¿›è¡Œæµ‹è¯•ä¾ç„¶å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œä»ä¸‹å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œè¶Šå¤„äºä¸Šå±‚çš„ç»„ä»¶ï¼Œå…¶å¤æ‚åº¦å¿…ç„¶ä¼šéšä¹‹æé«˜ã€‚å¯¹äºæœ€åº•å±‚çš„å­ç»„ä»¶æ¥è¯´ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“å¾—å°†å…¶è¿›è¡Œæ¸²æŸ“å¹¶æµ‹è¯•å…¶é€»è¾‘çš„æ­£ç¡®ä¸å¦ï¼Œä½†å¯¹äºè¾ƒä¸Šå±‚çš„çˆ¶ç»„ä»¶æ¥è¯´ï¼Œé€šå¸¸æ¥è¯´å°±éœ€è¦å¯¹å…¶æ‰€åŒ…å«çš„æ‰€æœ‰å­ç»„ä»¶éƒ½è¿›è¡Œé¢„å…ˆæ¸²æŸ“ï¼Œç”šè‡³äºæœ€ä¸Šé¢çš„ç»„ä»¶éœ€è¦æ¸²æŸ“å‡ºæ•´ä¸ª UI é¡µé¢çš„çœŸå® DOM èŠ‚ç‚¹æ‰èƒ½å¯¹å…¶è¿›è¡Œæµ‹è¯•ï¼Œè¿™æ˜¾ç„¶æ˜¯ä¸å¯å–çš„ã€‚

åœ¨å•å…ƒæµ‹è¯•ä¸­ï¼Œé€šå¸¸æˆ‘ä»¬å¸Œæœ›å°†é‡ç‚¹æ”¾åœ¨ä½œä¸ºç‹¬ç«‹å•å…ƒè¿›è¡Œæµ‹è¯•çš„ç»„ä»¶ä¸Šï¼Œå¹¶é¿å…é—´æ¥æ–­è¨€å…¶å­ç»„ä»¶çš„è¡Œä¸ºã€‚æ­¤å¤–ï¼Œå¯¹äºåŒ…å«è®¸å¤šå­ç»„ä»¶çš„ç»„ä»¶ï¼Œæ•´ä¸ª render æ ‘ä¼šå˜å¾—éå¸¸ä¹‹å¤§ï¼Œè€Œåå¤ render æ‰€æœ‰çš„å­ç»„ä»¶å¯èƒ½ä¼šå‡æ…¢å•å…ƒæµ‹è¯•çš„é€Ÿåº¦ã€‚

## æµ‹è¯•é‡‘å­—å¡”

> ä¸ºäº†ç»´æŒé‡‘å­—å¡”å½¢çŠ¶ï¼Œä¸€ä¸ªå¥åº·ã€å¿«é€Ÿã€å¯ç»´æŠ¤çš„æµ‹è¯•ç»„åˆåº”è¯¥æ˜¯è¿™æ ·çš„ï¼šå†™è®¸å¤šå°è€Œå¿«çš„å•å…ƒæµ‹è¯•ã€‚é€‚å½“å†™ä¸€äº›æ›´ç²—ç²’åº¦çš„æµ‹è¯•ï¼Œå†™å¾ˆå°‘é«˜å±‚æ¬¡çš„ç«¯åˆ°ç«¯æµ‹è¯•ã€‚æ³¨æ„ä¸è¦è®©ä½ çš„æµ‹è¯•å˜æˆå†°æ·‡æ·‹é‚£æ ·å­ï¼Œè¿™å¯¹ç»´æŠ¤æ¥è¯´å°†æ˜¯ä¸€ä¸ªå™©æ¢¦ï¼Œå¹¶ä¸”è·‘ä¸€éä¹Ÿéœ€è¦å¤ªå¤šæ—¶é—´ã€‚ï¼ˆvia [æµ‹è¯•é‡‘å­—å¡”å®æˆ˜ â€“ ThoughtWorks æ´è§]([https://insights.thoughtworks.cn/practical-test-pyramid/)ï¼‰](https://insights.thoughtworks.cn/practical-test-pyramid/)

![img](https://raw.staticdn.net/JimmyLv/images/master/2018/20181030211424.png)

## UI æµ‹è¯•ç­–ç•¥

- ç¼–å†™ä¸åŒç²’åº¦çš„æµ‹è¯•
- å±‚æ¬¡è¶Šé«˜ï¼Œä½ å†™çš„æµ‹è¯•åº”è¯¥è¶Šå°‘

# React ç»„ä»¶çš„æ¸²æŸ“æ–¹å¼

## âŒ æµ…æ¸²æŸ“ shallowMount(component[, options]) => Wrapper

```js
import { shallow } from 'enzyme'

describe('Enzyme Shallow', () => {
  it('App should have three <Todo /> components', () => {
    const app = shallow(<App />)
    expect(app.find('Todo')).to.have.length(3)
  })
})
```

æµ…æ¸²æŸ“åœ¨å°†ä¸€ä¸ªç»„ä»¶ä½œä¸ºä¸€ä¸ªå•å…ƒè¿›è¡Œæµ‹è¯•çš„æ—¶å€™éå¸¸æœ‰ç”¨ï¼Œå¯ä»¥ç¡®ä¿ä½ çš„æµ‹è¯•ä¸ä¼šå»é—´æ¥æ–­è¨€å­ç»„ä»¶çš„è¡Œä¸ºã€‚shallowMount æ–¹æ³•å°±æ˜¯ Shallow Rendering çš„å°è£…ï¼ŒshallowMount è·Ÿ mount ç±»ä¼¼è¿”å› mounted å’Œ rendered React ç»„ä»¶çš„ Wrapperï¼Œä½†åªä¼šæ¸²æŸ“å‡ºç»„ä»¶çš„ç¬¬ä¸€å±‚ DOM ç»“æ„ï¼Œå…¶åµŒå¥—çš„å­ç»„ä»¶ä¸ä¼šè¢«æ¸²æŸ“å‡ºæ¥ï¼Œä»è€Œä½¿å¾—æ¸²æŸ“çš„æ•ˆç‡æ›´é«˜ï¼Œå•å…ƒæµ‹è¯•çš„é€Ÿåº¦ä¹Ÿä¼šæ›´å¿«ã€‚

## å…¨é‡æ¸²æŸ“ mount(component[, options]) => Wrapper

```js
import { mount } from 'enzyme'

describe('Enzyme Mount', () => {
  it('should delete Todo when click button', () => {
    const app = mount(<App />)
    const todoLength = app.find('li').length
    app.find('button.delete').at(0).simulate('click')
    expect(app.find('li').length).to.equal(todoLength - 1)
  })
})
```

mount æ–¹æ³•åˆ™ä¼šå°† React ç»„ä»¶å’Œæ‰€æœ‰å­ç»„ä»¶æ¸²æŸ“ä¸ºçœŸå®çš„ DOM èŠ‚ç‚¹ï¼Œç‰¹åˆ«æ˜¯åœ¨ä½ ä¾èµ–çœŸå®çš„ DOM ç»“æ„å¿…é¡»å­˜åœ¨çš„æƒ…å†µä¸‹ï¼Œæ¯”å¦‚è¯´æŒ‰é’®çš„ç‚¹å‡»äº‹ä»¶ã€‚å®Œå…¨çš„ DOM æ¸²æŸ“éœ€è¦åœ¨å…¨å±€èŒƒå›´å†…æä¾›å®Œæ•´çš„ DOM APIï¼Œ è¿™ä¹Ÿå°±æ„å‘³ç€ React Test Utils ä¾èµ–äºæµè§ˆå™¨ç¯å¢ƒã€‚

ä»æŠ€æœ¯ä¸Šè®²ï¼Œä½ å¯ä»¥åœ¨çœŸå®çš„æµè§ˆå™¨ä¸­è¿è¡Œï¼Œä½†ç”±äºåœ¨ä¸åŒå¹³å°ä¸Šå¯åŠ¨çœŸå®æµè§ˆå™¨çš„å¤æ‚æ€§ï¼Œæ›´å»ºè®®ä½¿ç”¨ JSDOM åœ¨è™šæ‹Ÿæµè§ˆå™¨ç¯å¢ƒä¸­è¿è¡Œ Node ä¸­çš„æµ‹è¯•ã€‚æ¨èä½¿ç”¨ mount çš„æ–¹æ³•æ˜¯ä¾èµ–äºä¸€ä¸ªåä¸º jsdom çš„åº“ï¼Œå®ƒæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªå®Œå…¨åœ¨ JavaScript ä¸­å®ç°çš„ headless æµè§ˆå™¨ã€‚

## Testing Library vs Enzyme

React Testing Library çš„ API æ˜æ˜¾ä¼˜äº Enzymeï¼Œä¸è‡³äºé™·å…¥ç»†èŠ‚ï¼Œæ˜¯ç”¨äºæµ‹è¯• React åº”ç”¨çš„ä¸€å¤§åˆ©å™¨ã€‚å‰ç«¯ UI ç»„ä»¶æµ‹è¯•çš„æœ€ä½³å®è·µï¼Œä½¿å¾—æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®ƒæ¥æ›´æœ‰æ•ˆåœ°æµ‹è¯•ç»„ä»¶ã€‚

```js
import { screen, render } from '@testing-library/react'

test('should show h1 title', () => {
  // given
  render(<App />)

  // when
  const result = screen.getByTestId('title').textContent

  // then
  expect(result).toBe('Edmodo')
})
```

## [**Which query should I use?**](https://testing-library.com/docs/guide-which-query)

| **type**       | **_No Match_** | **_1 Match_** | **_1+ Match_** | **_Await?_** |
| -------------- | -------------- | ------------- | -------------- | ------------ |
| **_getBy_**    | _throw_        | _return_      | _throw_        | _No_         |
| **_findBy_**   | _throw_        | _return_      | _throw_        | _Yes_        |
| **_queryBy_**  | _null_         | _return_      | _throw_        | _No_         |
| **getAllBy**   | throw          | array         | array          | No           |
| **findAllBy**  | throw          | array         | array          | Yes          |
| **queryAllBy** | []             | array         | array          | No           |

## UI äº¤äº’è¡Œä¸ºçš„æµ‹è¯•

![img](https://jimmylv.gitee.io/slides/images/react-user-event.png)

æˆ‘ä»¬ä¸ä½†å¯ä»¥é€šè¿‡ find æ–¹æ³•æŸ¥æ‰¾ DOM å…ƒç´ ï¼Œè¿˜å¯ä»¥é€šè¿‡ simulate æ–¹æ³•åœ¨ç»„ä»¶ä¸Šæ¨¡æ‹Ÿè§¦å‘æŸä¸ª DOM äº‹ä»¶ï¼Œæ¯”å¦‚ Clickï¼ŒChange ç­‰ç­‰ã€‚å¯¹äºæµ…æ¸²æŸ“æ¥è¯´ï¼Œäº‹ä»¶æ¨¡æ‹Ÿå¹¶ä¸ä¼šåƒçœŸå®ç¯å¢ƒä¸­æ‰€é¢„æœŸçš„é‚£æ ·è¿›è¡Œä¼ æ’­ï¼Œå› æ­¤æˆ‘ä»¬å¿…é¡»åœ¨ä¸€ä¸ªå·²ç»è®¾ç½®å¥½äº†äº‹ä»¶å¤„ç†æ–¹æ³•çš„å®é™…èŠ‚ç‚¹ä¸Šæ‰èƒ½å¤Ÿè°ƒç”¨ï¼Œå®é™…ä¸Š .simulate() æ–¹æ³•å°†ä¼šæ ¹æ®æ¨¡æ‹Ÿçš„äº‹ä»¶è§¦å‘è¿™ä¸ªç»„ä»¶çš„ propã€‚ä¾‹å¦‚ï¼Œ.simulate('click') å®é™…ä¸Šä¼šè·å– å¯¹åº”çš„ clickHandler propsData å¹¶è°ƒç”¨å®ƒã€‚

## âŒ Enzyme .find() æ–¹æ³•

```js
it('simulates click events', () => {
  // given
  const onButtonClick = sinon.spy()
  const wrapper = shallow(<Foo onButtonClick={onButtonClick} />)

  // when
  wrapper.find('button').simulate('click')

  // then
  expect(onButtonClick.calledOnce).to.be.true
})
```

## âœ… Testing Library userEvent

```js
import { render, screen } from '@testing-library/react'
import userEvent from '@testing-library/user-event'

test('should calculate result by input number', () => {
  render(<App />)

  userEvent.type(screen.getByPlaceholderText(/Please input your number/i), 15)

  expect(wrapper.getByTestId('number-result').textContent).toBe('FizzBuzz')
})
```

# å¦‚ä½•ç†è§£ Redux æ¨¡å¼ï¼Ÿ

## Redux çš„å‰è½¦ä¹‹é‰´

![Redux data flow diagram](https://redux.js.org/assets/images/ReduxDataFlowDiagram-49fa8c3968371d9ef6f2a1486bd40a26.gif)

> Redux æ˜¯ä¸€ä¸ªä¸“ä¸º React.js åº”ç”¨ç¨‹åºå¼€å‘çš„çŠ¶æ€ç®¡ç†æ¨¡å¼ã€‚å®ƒé‡‡ç”¨é›†ä¸­å¼å­˜å‚¨ç®¡ç†åº”ç”¨çš„æ‰€æœ‰ç»„ä»¶çš„çŠ¶æ€ï¼Œå¹¶ä»¥ç›¸åº”çš„è§„åˆ™ä¿è¯çŠ¶æ€ä»¥ä¸€ç§å¯é¢„æµ‹çš„æ–¹å¼å‘ç”Ÿå˜åŒ–ã€‚

å¤äººè¯´ã€Œè¯»å²è®©äººæ˜æ™ºã€ï¼Œå­¦ä¹ å†å²æ˜¯ä¸ºäº†æ›´å¥½å¾—å‰è¡Œï¼Œä¸ºäº†èƒ½å¤Ÿè®¤è¯†ç°åœ¨ï¼Œçœ‹æ¸…æœªæ¥ã€‚è®©æˆ‘ä»¬æ¥çœ‹çœ‹ Redux çš„å†å²ï¼ŒRedux å€Ÿé‰´äº Reduxï¼Œè€Œ Redux çš„å®ç°æ„æƒ³åˆ™æœ€åˆå‡ºèº«äº [Flux](http://facebook.github.io/flux/docs/overview.html) ï¼Œè¿™æ˜¯ä¸€ä¸ªç”± Facebook ä¸ºå…¶åº”ç”¨æ‰€è®¾è®¡çš„åº”ç”¨ç¨‹åºæ¶æ„ã€‚Flux æ¨¡å¼åœ¨ JavaScript åº”ç”¨é‡Œåƒæ˜¯æ‰¾åˆ°äº†æ–°å®¶ä¸€æ ·ï¼Œä½†å…¶å®åªæ˜¯å€Ÿé‰´äº†**é¢†åŸŸé©±åŠ¨è®¾è®¡** (DDD) å’Œ**å‘½ä»¤-æŸ¥è¯¢èŒè´£åˆ†ç¦»** (CQRS)ã€‚

## MVC ä¸ Flux æ¶æ„

![image-20210228183300367](https://raw.staticdn.net/JimmyLv/images/master/2021/image-20210228183300367.png)æè¿° Flux æœ€æ™®éçš„ä¸€ç§çš„æ–¹å¼å°±æ˜¯å°†å…¶ä¸ **Model-View-Controller** (MVC) æ¶æ„è¿›è¡Œå¯¹æ¯”ã€‚

åœ¨ MVC å½“ä¸­ï¼Œä¸€ä¸ª Model å¯ä»¥è¢«å¤šä¸ª Views è¯»å–ï¼Œå¹¶ä¸”å¯ä»¥è¢«å¤šä¸ª Controllers è¿›è¡Œæ›´æ–°ã€‚åœ¨å¤§å‹åº”ç”¨å½“ä¸­ï¼Œå•ä¸ª Model ä¼šå¯¼è‡´å¤šä¸ª Views å»é€šçŸ¥ Controllersï¼Œå¹¶å¯èƒ½è§¦å‘æ›´å¤šçš„ Model æ›´æ–°ï¼Œè¿™æ ·ç»“æœå°±ä¼šå˜å¾—éå¸¸å¤æ‚ã€‚

## CQRS ä¸ Flux æ¶æ„

![image-20210228183307490](https://raw.staticdn.net/JimmyLv/images/master/2021/image-20210228183307490.png)

è€Œ Flux ä»¥åŠæˆ‘ä»¬è¦å­¦ä¹ çš„ Redux åˆ™æ˜¯è¯•å›¾é€šè¿‡å¼ºåˆ¶å•å‘æ•°æ®æµæ¥è§£å†³è¿™ä¸ªå¤æ‚åº¦ã€‚åœ¨è¿™ç§æ¶æ„å½“ä¸­ï¼ŒViews æŸ¥è¯¢ Storesï¼ˆè€Œä¸æ˜¯ Modelsï¼‰ï¼Œå¹¶ä¸”ç”¨æˆ·äº¤äº’å°†ä¼šè§¦å‘ Actionsï¼ŒActions åˆ™ä¼šè¢«æäº¤åˆ°ä¸€ä¸ªé›†ä¸­çš„ Dispatcher å½“ä¸­ã€‚å½“ Actions è¢«æ´¾å‘ä¹‹åï¼ŒStores å°†ä¼šéšä¹‹æ›´æ–°è‡ªå·±å¹¶ä¸”é€šçŸ¥ Views è¿›è¡Œä¿®æ”¹ã€‚è¿™äº› Store å½“ä¸­çš„ä¿®æ”¹ä¼šè¿›ä¸€æ­¥ä¿ƒä½¿ Views æŸ¥è¯¢æ–°çš„æ•°æ®ã€‚

MVC å’Œ Flux æœ€å¤§çš„ä¸åŒå°±æ˜¯æŸ¥è¯¢å’Œæ›´æ–°çš„åˆ†ç¦»ã€‚åœ¨ MVC ä¸­ï¼ŒModel åŒæ—¶å¯ä»¥è¢« Controller æ›´æ–°*å¹¶ä¸”*è¢« View æ‰€æŸ¥è¯¢ã€‚åœ¨ Flux é‡Œï¼ŒView ä» Store è·å–çš„æ•°æ®æ˜¯åªè¯»çš„ã€‚è€Œ Stores åªèƒ½é€šè¿‡ Actions è¢«æ›´æ–°ï¼Œè¿™å°±ä¼šå½±å“ Store æœ¬èº«*è€Œä¸æ˜¯*é‚£äº›åªè¯»çš„æ•°æ®ã€‚

## CQRS å‘½ä»¤-æŸ¥è¯¢èŒè´£åˆ†ç¦»

1. å¦‚æœä¸€ä¸ªæ–¹æ³•ä¿®æ”¹äº†è¿™ä¸ªå¯¹è±¡çš„çŠ¶æ€ï¼Œé‚£å°±æ˜¯ä¸€ä¸ª _command_ï¼ˆå‘½ä»¤ï¼‰ï¼Œå¹¶ä¸”ä¸€å®šä¸èƒ½è¿”å›å€¼ã€‚
2. å¦‚æœä¸€ä¸ªæ–¹æ³•è¿”å›äº†ä¸€äº›å€¼ï¼Œé‚£å°±æ˜¯ä¸€ä¸ª _query_ï¼ˆæŸ¥è¯¢ï¼‰ï¼Œå¹¶ä¸”ä¸€å®šä¸èƒ½ä¿®æ”¹çŠ¶æ€ã€‚

![Redux data flow diagram](https://redux.js.org/assets/images/ReduxDataFlowDiagram-49fa8c3968371d9ef6f2a1486bd40a26.gif)

# Redux èƒŒåçš„åŸºæœ¬æ€æƒ³

æ‰€ä»¥è¯´ï¼Œ Redux å°±æ˜¯æŠŠç»„ä»¶çš„å…±äº«çŠ¶æ€ â€œstateâ€ æŠ½å–å‡ºæ¥ï¼Œä»¥**ä¸€ä¸ª**å…¨å±€ â€œstoreâ€ çš„å•ä¾‹æ¨¡å¼ç»Ÿä¸€ç®¡ç†ã€‚

åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œæˆ‘ä»¬çš„ç»„ä»¶æ ‘æ„æˆäº†ä¸€ä¸ªå·¨å¤§çš„â€œè§†å›¾â€ï¼Œä¸ç®¡åœ¨æ ‘çš„å“ªä¸ªä½ç½®ï¼Œä»»ä½•ç»„ä»¶éƒ½èƒ½è·å–çŠ¶æ€æˆ–è€…è§¦å‘è¡Œä¸ºã€‚

## Redux ä¸‰å¤§åŸåˆ™ï¼šå¼ºåˆ¶éµå®ˆä¸€å®šçš„è§„åˆ™

### 1. å•ä¸€æ•°æ®æº

æ•´ä¸ªåº”ç”¨çš„ [state](https://cn.redux.js.org/docs/Glossary.html#state) è¢«å‚¨å­˜åœ¨ä¸€æ£µ object tree ä¸­ï¼Œå¹¶ä¸”è¿™ä¸ª object tree åªå­˜åœ¨äºå”¯ä¸€ä¸€ä¸ª [store](https://cn.redux.js.org/docs/Glossary.html#store) ä¸­ã€‚ä»»ä½•ç»„ä»¶éƒ½èƒ½ç›´æ¥è·å– store çŠ¶æ€ï¼Œè¿™ä¹Ÿå°±æ˜¯ CQRS ä¸­ _query_ï¼ˆæŸ¥è¯¢ï¼‰çš„ä¸€ç§å®ç°ã€‚

### 2. State æ˜¯åªè¯»çš„

å”¯ä¸€æ”¹å˜ state çš„æ–¹æ³•å°±æ˜¯æ˜¾å¼åœ°è§¦å‘ä¸€ä¸ª [action](https://cn.redux.js.org/docs/Glossary.html#action)ï¼Œaction æ˜¯ä¸€ä¸ªç”¨äºæè¿°å·²å‘ç”Ÿäº‹ä»¶çš„æ™®é€šå¯¹è±¡ã€‚å¦‚æœéœ€è¦æ”¯æŒå¼‚æ­¥æ•°æ®æµï¼Œåˆ™éœ€è¦åƒ [redux-thunk](https://github.com/gaearon/redux-thunk) æˆ– [redux-promise](https://github.com/acdlite/redux-promise) è¿™æ ·æ”¯æŒå¼‚æ­¥çš„ middleware ä¸­é—´ä»¶ã€‚

### 3. ä½¿ç”¨çº¯å‡½æ•°æ¥æ‰§è¡Œä¿®æ”¹

ä¸ºäº†æè¿° action å¦‚ä½•æ”¹å˜ state tree ï¼Œä½ éœ€è¦ç¼–å†™ [reducers](https://cn.redux.js.org/docs/Glossary.html#reducer)ã€‚è¿™ä¹Ÿå°±æ˜¯ CQRS ä¸­ _command_ï¼ˆå‘½ä»¤ï¼‰çš„ä¸€ç§å®ç°ã€‚

# å¦‚ä½•å¯¹ Redux è¿›è¡Œå•å…ƒæµ‹è¯•

å¾—ç›Šäº Redux èƒ½å¤Ÿå°† React åº”ç”¨çš„å…±äº«çŠ¶æ€è¿›è¡Œéš”ç¦»ï¼Œæˆ‘ä»¬çš„ä»£ç ä¹Ÿå› æ­¤å˜å¾—æ›´åŠ ç»“æ„åŒ–ä¸”æ˜“äºç»´æŠ¤ï¼ŒRedux ä¸­çš„ reducerã€action å’Œ selector éƒ½è¢«æ”¾åœ¨äº†åˆç†çš„ä½ç½®ï¼Œæ‰¿æ‹…ä¸åŒçš„èŒè´£ ï¼Œè¿™ä¹Ÿä½¿å¾—å¯¹å®ƒä»¬è¿›è¡Œå•å…ƒæµ‹è¯•å˜å¾—å®¹æ˜“å¾ˆå¤šã€‚

## reducers æµ‹è¯•

```js
import reducers from './reducers'
import actions from './actions'

test(`
  should merge user comments and remove duplicated comments by comment id
  when action saveUserComments is dispatched with new fetched comments
`, () => {
  const state = {
    comments: [{ id: 1, content: 'comments-1' }],
  }
  const comments = [
    { id: 1, content: 'comments-1' },
    { id: 2, content: 'comments-2' },
  ]

  const expected = {
    comments: [
      { id: 1, content: 'comments-1' },
      { id: 2, content: 'comments-2' },
    ],
  }

  const result = reducers(state, actions.saveUserComments(comments))

  expect(result).toEqual(expected)
})
```

Reducer å¾ˆå®¹æ˜“è¢«æµ‹è¯•ï¼Œå› ä¸ºå®ƒä»¬ä»…ä»…æ˜¯ä¸€äº›å®Œå…¨ä¾èµ–å‚æ•°çš„å‡½æ•°ã€‚æœ€ä¸ºç®€å•çš„ reducer æµ‹è¯•ï¼Œä»…ä¸€ä¸€å¯¹åº”ä¿å­˜æ•°æ®åˆ‡ç‰‡ã€‚æ­¤ç§ reducer å¯ä»¥ä¸éœ€è¦æµ‹è¯•è¦†ç›–ï¼Œå› ä¸ºåŸºæœ¬ç”±æ¶æ„ç®€å•å’Œé€»è¾‘ç®€å•ä¿è¯ï¼Œä¸éœ€è¦é è¯»æµ‹è¯•ç”¨ä¾‹æ¥ç†è§£ã€‚è€Œä¸€ä¸ªè¾ƒä¸ºå¤æ‚ã€å…·å¤‡æµ‹è¯•ä»·å€¼çš„ reducer åœ¨ä¿å­˜æ•°æ®çš„åŒæ—¶ï¼Œè¿˜å¯èƒ½è¿›è¡Œäº†åˆå¹¶ã€å»é‡ç­‰æ“ä½œã€‚

## actions æµ‹è¯•

```js
import * as actions from './actions'

test('should dispatch saveUserComments action with fetched user comments', () => {
  const comments = []
  const expected = {
    type: 'saveUserComments',
    payload: {
      comments: [],
    },
  }

  const result = actions.saveUserComments(comments)

  expect(result).toEqual(expected)
})
```

Action åº”å¯¹èµ·æ¥ç•¥å¾®æ£˜æ‰‹ï¼Œå› ä¸ºå®ƒä»¬å¯èƒ½éœ€è¦è°ƒç”¨å¤–éƒ¨çš„ APIã€‚å½“æµ‹è¯• action çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦å¢åŠ ä¸€ä¸ª mocking æœåŠ¡å±‚â€”â€”ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠ API è°ƒç”¨æŠ½è±¡æˆæœåŠ¡ï¼Œç„¶ååœ¨æµ‹è¯•æ–‡ä»¶ä¸­ç”¨ mock æœåŠ¡å“åº”æ‰€æœŸæœ›çš„ API è°ƒç”¨ã€‚

## å¼‚æ­¥ Action æµ‹è¯•

```js
// product.test.js
jest.mock('../api/book', () => ({
  getBookList: jest.fn(() => {
    data: [{ name: 'ä½ ä¸çŸ¥é“çš„JavaScript' }]
  }),
}))

test('should fetch book list', async () => {
  const payload = { category: 'æ–‡å­¦' }

  const { storeState } = await expectSaga(sagas).withReducer(reducer).dispatch({ type: types.FETCH, payload }).run()

  expect(service.getAllBooks).toBeCalledWith(payload)
  expect(storeState).toEqual({
    list: [{ name: 'ä½ ä¸çŸ¥é“çš„JavaScript' }],
    total: 1,
    error: null,
  })
})
```

## selectors æµ‹è¯•

```js
// book.js
export const getBookList = (state) => state.book.list

export const getBooksByCategory = createSelector(
  getBookList,
  (_, category) => category,
  (books, category) => books.filter((book) => book.category === category),
)
```

Note: selector çš„æµ‹è¯•ä¸ mutation ä¸€æ ·ç›´æˆªäº†å½“ã€‚selectors ä¹Ÿæ˜¯æ¯”è¾ƒé‡é€»è¾‘çš„åœ°æ–¹ï¼Œå¹¶ä¸”å®ƒä¹Ÿæ˜¯ä¸€ä¸ªçº¯å‡½æ•°ï¼Œä¸ reducers æµ‹è¯•äº«å—åŒæ ·å¾…é‡ï¼šçº¯å‡€çš„è¾“å…¥è¾“å‡ºï¼Œç®€æ˜“çš„æµ‹è¯•å‡†å¤‡ã€‚ä¸‹é¢æ¥çœ‹ä¸€ä¸ªç¨å¾®ç®€å•ç‚¹çš„ getters æµ‹è¯•ç”¨ä¾‹ï¼š

```js
// book.test.js
test('should get book by category', () => {
  const category = 'å‰ç«¯'

  expect(getBooksByCategory(state, category)).toEqual([{ name: 'ä½ ä¸çŸ¥é“çš„JavaScript' }])
})
```

# React ç»„ä»¶å’Œ Redux store çš„äº¤äº’

å‰é¢æˆ‘ä»¬è®²å®Œäº† Redux å•å…ƒæµ‹è¯•æ‰€éœ€è¦çš„åŸºæœ¬çŸ¥è¯†ï¼Œè€Œ React ç»„ä»¶éœ€è¦ä» Redux store è¯»å–çŠ¶æ€æˆ–è€…æ˜¯å‘é€ action æ”¹å˜ store çŠ¶æ€çš„æ—¶å€™ï¼Œåˆè¯¥å¦‚ä½•æµ‹è¯•ä»–ä»¬ä¹‹é—´çš„äº¤äº’å‘¢ï¼Ÿæ¥ä¸‹æ¥å°±æ¥èŠèŠå¦‚ä½•ç”¨ React Test Utils æµ‹è¯• React ç»„ä»¶ä¸­çš„ Reduxã€‚

```js
export function BookList({ category }) {
  const location = useLocation()
  const { tag } = queryString.parse(location.search)

  const booksByCategory = useSelector((state) => getBooksByCategory(state, category))
  const books = tag ? booksByCategory.filter((book) => book.tags.includes(tag)) : booksByCategory

  return <>...</>
}
```

ç«™åœ¨å•å…ƒæµ‹è¯•çš„è§’åº¦ï¼Œå…¶å®æˆ‘ä»¬åœ¨æµ‹è¯• React ç»„ä»¶ï¼ˆå•å…ƒï¼‰çš„æ—¶å€™ä¸éœ€è¦å…³å¿ƒ Redux store é•¿ä»€ä¹ˆæ ·å­ï¼Œæˆ‘ä»¬åªéœ€è¦çŸ¥é“ Redux store å½“ä¸­çš„è¿™äº› action å°†ä¼šåœ¨é€‚å½“çš„æ—¶æœºè§¦å‘ï¼Œä»¥åŠå®ƒä»¬è§¦å‘æ—¶çš„é¢„æœŸè¡Œä¸ºæ˜¯ä»€ä¹ˆã€‚

## ReduxWrapper renderWithRedux()

```js
export function ReduxWrapper({ initialState, store = mockStore(initialState), children }) {
  return <Provider store={store}>{children}</Provider>
}

export function renderWithRedux(ui, { initialState, store = mockStore(initialState) } = {}) {
  return {
    ...render(
      <ReduxWrapper initialState={initialState} store={store}>
        {ui}
      </ReduxWrapper>,
    ),
    store,
  }
}
```

åœ¨å•å…ƒæµ‹è¯•çš„æ—¶å€™ï¼ŒshallowMountï¼ˆæµ…æ¸²æŸ“ï¼‰æ–¹æ³•æ¥å—ä¸€ä¸ªæŒ‚è½½ optionsï¼Œå¯ä»¥ç”¨æ¥ç»™ React ç»„ä»¶ä¼ é€’ä¸€ä¸ªä¼ªé€ çš„ storeã€‚ç„¶åæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ Jest æ¨¡æ‹Ÿä¸€ä¸ª action çš„è¡Œä¸ºå†ä¼ ç»™ storeï¼Œè€Œ actionClick è¿™ä¸ªä¼ªé€ å‡½æ•°èƒ½å¤Ÿè®©æˆ‘ä»¬å»æ–­è¨€è¯¥ action æ˜¯å¦è¢«è°ƒç”¨è¿‡ã€‚æ‰€ä»¥æˆ‘ä»¬åœ¨æµ‹è¯• action çš„æ—¶å€™å°±å¯ä»¥åªå…³å¿ƒ action çš„è§¦å‘ï¼Œè€Œè‡³äºè§¦å‘ä¹‹åå¯¹ store åšäº†ä»€ä¹ˆäº‹æƒ…æˆ‘ä»¬å°±ä¸éœ€è¦å†å…³å¿ƒäº†ï¼Œå› ä¸º Redux çš„å•å…ƒæµ‹è¯•ä¼šæ¶µç›–ç›¸å…³çš„ä»£ç é€»è¾‘ã€‚

## RouterWrapper renderWithRouter()

```js
export const RouterWrapper = ({
  route = '/',
  history = createMemoryHistory({ initialEntries: [route] }),
  children,
}) => <Router history={history}>{children}</Router>

export function renderWithRouter(ui, { route = '/', history = createMemoryHistory({ initialEntries: [route] }) } = {}) {
  return {
    ...render(
      <RouterWrapper route={route} history={history}>
        {ui}
      </RouterWrapper>,
    ),
    history,
  }
}
```

# æ€»ç»“ä¸€ä¸‹

- **# å•å…ƒæµ‹è¯•åŸºç¡€**
- **# React å•å…ƒæµ‹è¯•**
- **# Redux å•å…ƒæµ‹è¯•**
- **# React åº”ç”¨æµ‹è¯•ç­–ç•¥**

## ğŸ¤“ æ€»ç»“ï¼šå¿«é€Ÿå“åº”å˜åŒ–ï¼Œç¼©çŸ­åé¦ˆå‘¨æœŸ

- ç¼ºå°‘**å¯é‡æ„æ€§**çš„è½¯ä»¶ï¼Œä¸å¯èƒ½å¿«é€Ÿå“åº”å˜åŒ–ã€‚
- æ²¡æœ‰é«˜è¦†ç›–ç‡ã€å¿«é€Ÿè¿è¡Œçš„**å•å…ƒæµ‹è¯•**ï¼Œé‡æ„å°±ä¸å¯èƒ½è½åœ°ã€‚
- **æµ‹è¯•é©±åŠ¨å¼€å‘**æ˜¯è·å¾—é«˜è´¨é‡å•å…ƒæµ‹è¯•é›†çš„å”¯ä¸€æœ‰æ•ˆæ–¹æ³•ã€‚
- å»ºç«‹åœ¨å……åˆ†è¦†ç›–ä¸”è¿è¡Œå¿«é€Ÿçš„è‡ªåŠ¨åŒ–æµ‹è¯•åŸºç¡€ä¸Šçš„**æŒç»­é›†æˆ**æ˜¯è¿­ä»£å¼å¼€å‘çš„å¿…è¦æ¡ä»¶ã€‚

> ç¼ºé™·å‘ç°è¶Šæ—©ï¼Œä¿®å¤æˆæœ¬è¶Šä½

## é™„å½•ï¼šæ­¦æ—ç§˜ç± ğŸ““

### Tasking ä»»åŠ¡åˆ†è§£

- å®Œå…¨ç©·å°½
- ç›¸äº’ç‹¬ç«‹

### Testing å•å…ƒæµ‹è¯•

- Given
- When
- Then

### Refactoring é‡æ„

- æ—§çš„ä¸å˜ï¼Œæ–°çš„åˆ›å»ºï¼›
- ä¸€æ­¥åˆ‡æ¢ï¼Œæ—§çš„å†è§ã€‚

![img](https://jimmylv.gitee.io/slides/images/tdd/Test-Driven-Development-Cycle.jpg)

# ğŸ“š æ¨èä¹¦ç±

- [React å®˜æ–¹ä¸­æ–‡æ–‡æ¡£ â€“ ç”¨äºæ„å»ºç”¨æˆ·ç•Œé¢çš„ JavaScript åº“](https://zh-hans.reactjs.org/)
- [React Testing Library](https://testing-library.com/docs/react-testing-library/intro/)
- ã€Šæ·±å…¥ React æŠ€æœ¯æ ˆã€‹
- ã€Šæ·±å…¥æµ…å‡º React å’Œ Reduxã€‹
- ã€Šé‡æ„ 2ï¼šæ”¹å–„æ—¢æœ‰ä»£ç çš„è®¾è®¡ã€‹
- ã€ŠClean Code ä»£ç æ•´æ´ä¹‹é“ã€‹
- ã€ŠRefactoring to Patterns é‡æ„ä¸æ¨¡å¼ã€‹
- ã€ŠSICP è®¡ç®—æœºç¨‹åºçš„æ„é€ å’Œè§£é‡Šã€‹
